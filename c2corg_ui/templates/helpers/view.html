<%! from c2corg_ui.templates.utils import get_attr %>
<%def name="show_attr(obj, key, parse=True)">\
  <%
      attr = get_attr(obj, key, md=parse, bb=parse)
      attr = attr if attr else ''
  %>
  ${attr | n}\
</%def>

<%def name="show_short_attr(obj, attr, type='raw', suffix='')">\
  % if attr in obj and obj[attr]:
      % if type == 'i18n':
        <span class="detail-value">{{mainCtrl.translate('${obj[attr]}')}}</span>
      % elif type == 'list':
        <span class="detail-text" ng-repeat="val in ['${"','".join(obj[attr]) |n}']">{{mainCtrl.translate(val)}}</span>
      % elif type =='text':
        <span class="detail-text">${show_attr(obj, attr)}</span>
      % else:
        <span class="detail-text">${obj[attr]}${suffix}</span>
      % endif
  % endif
</%def>

<%def name="show_archive_data(module, document, locale, version)">\
  <article class="archive-data">
    <h2><span class="glyphicon glyphicon-warning-sign"></span>&nbsp;<span translate>You are viewing an archived version of this document.</span></h2>
    <div class="text-left">
      <p><b translate>Date</b>: {{'${1000 * version['written_at']}' | date:'medium'}} &nbsp;<span translate>by</span>&nbsp; <a href="#TODO">${version['username']}</a></p>
      <p><b translate>Changes</b>: ${show_version_comment(version)}</p>
    </div>
    <p class="text-center">
        <a href="${request.route_url(module + '_view', id=document['document_id'], lang=locale['lang'])}">
          <button class="btn btn-default" translate>See the latest version</button>
        </a>
    </p>
  </article>
</%def>

<%def name="show_other_langs_links(module, document, other_langs)">\
  % if other_langs:
    <div id="other-langs">
      <div class="modal-header"><h3 class="text-center" translate>View in other lang</h3></div>  
      <ul>
      % for l in other_langs:
        <li>
          <a href="${request.route_url(module + '_view', id=document['document_id'], lang=l)}">{{mainCtrl.translate('${l}')}}</a>
          <span class="glyphicon glyphicon-chevron-right"></span>
        </li>
      % endfor
      </ul>
    </div>
  % endif
</%def>

<%def name="show_missing_langs_links(module, document, missing_langs)">\
% if missing_langs:
  <div  id="missing-langs">
    <div class="modal-header"><h3 class="text-center" translate>Translate into an other lang</h3></div>  
    <ul>
      % for lang in missing_langs:
      <li>
      <app-edit-button app-edit-button-url="${request.route_url(module + '_edit', id=document['document_id'], lang=lang)}">
        {{mainCtrl.translate('${lang}')}}
        <span class="glyphicon glyphicon-chevron-right"></span>
      </app-edit-button>
      </li>
      % endfor
    </ul>
</div>
% endif
</%def>

<%def name="show_route_title(locale, is_tab_title=False)">\
  <%
      title = ''
      if 'title_prefix' in locale and locale['title_prefix']:
          title = locale['title_prefix'] + ' : '
      title += locale['title']
  %>\
  ${title}${' - Camptocamp.org' if is_tab_title else ''}\
</%def>

<%def name="show_version_comment(version)">\
  ${get_attr(version, 'comment', md=False)  if version['comment'] else '' | n}
</%def>

<%def name="show_associated_waypoints(document, type=None)">\
  % if 'waypoints' in document['associations']:
    % for w in document['associations']['waypoints']:
      % if type is None or type == w['waypoint_type']:
      <div class="list-item">
        <a href="${request.route_url('waypoints_view', id=w['document_id'], lang=w['locales'][0]['lang'])}">${w['locales'][0]['title']}</a>
        <app-delete-association parent-id="${document['document_id']}" child-id="${w['document_id']}"></app-delete-association>
      </div>
      % endif
    % endfor
  % endif
</%def>

<%def name="show_associated_routes(document)">\
  % if 'routes' in document['associations']:
    % for r in document['associations']['routes']:
    <div class="list-item">
      <a href="${request.route_url('routes_view', id=r['document_id'], lang=r['locales'][0]['lang'])}">${r['locales'][0]['title']}</a>
      <app-delete-association parent-id="${document['document_id']}" child-id="${r['document_id']}"></app-delete-association>
    </div>
    % endfor
  % endif
</%def>

<%def name="show_maps(document)">\
  % if len(document['maps']) > 0:
    <ul>
    % for m in document['maps']:
      <li>${m['editor']} ${m['locales'][0]['title']}</li>
    % endfor
    </ul>
  % else :
  <p translate>No maps associated</p>
  % endif
</%def>

<%def name="show_areas(document)">\
  % if document.get('areas'):
    <ul>
      % for a in document['areas']:
        <li ng-cloak>{{mainCtrl.translate('${a["area_type"]} ')}}: <b>${a['locales'][0]['title']}</b></li>
      % endfor
    </ul>
  % endif
</%def>


## Float buttons
<%def name="show_float_buttons(string, doc_id, doc_lang, other_langs, missing_langs)">\
  <div class="float-buttons" app-view-details>
    <div class="float-button float-edit" tooltip-placement="left" uib-tooltip="{{'Edit' | translate}}">
      <app-edit-button ng-click="ebCtrl.redirect()" app-edit-button-url="${request.route_url( string + '_edit' , id=doc_id, lang=doc_lang)}"></app-edit-button>
      <span class="glyphicon glyphicon-edit"></span>
      <p class="float-button-text" translate>Edit</p>
    </div>
    <div class="float-button float-favorite" tooltip-placement="left" uib-tooltip="{{'Add to favorites' | translate}}">
      <span class="glyphicon glyphicon-heart"></span>
      <p class="float-button-text" translate>Favorites</p>
    </div>
    <div class="float-button float-add" tooltip-placement="left" uib-tooltip="{{'Add' | translate}}">
      <span class="glyphicon glyphicon-plus"></span>
      <p class="float-button-text" translate>Add</p>
    </div>
    <div class="float-button float-comments" tooltip-placement="left" uib-tooltip="{{'Comments' | translate}}">
      <span class="glyphicon glyphicon-comment"></span>
      <p class="float-button-text" translate>Comments</p>
    </div>
    <div class="btn-group float-more float-button " uib-dropdown tooltip-placement="left" uib-tooltip="{{'More' | translate}}">
      <span class="glyphicon glyphicon-th-list dropdown-toggle" uib-dropdown-toggle></span>
      <p class="float-button-text" translate>More</p>
      <ul class="dropdown-menu"  role="menu" aria-labelledby="dLabel">
        <li><a href="${request.route_url(string + '_history', id=doc_id, lang=doc_lang)}" translate>History</a></li>
        % if other_langs:
        <li ng-click="detailsCtrl.openModal('#other-langs')"><a translate>View in other lang</a></li>
        % endif
        % if missing_langs:
        <li ng-click="detailsCtrl.openModal('#missing-langs')"><a translate>Translate into an other lang</a></li>
        % endif
        <li role="separator" class="divider"></li>
        <li><a href="#">Print</a></li>
        <li><a href="#">Save</a></li>
      </ul>
    </div>
  </div>

</%def>