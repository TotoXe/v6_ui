<%!
from c2corg_ui.templates.utils import get_attr
%>

<%def name="show_attr(obj, key, parse=True)">\
  <%
      attr = get_attr(obj, key, md=parse, bb=parse)
      attr = attr if attr else ''
  %>
  ${attr | n}\
</%def>

<%def name="show_short_attr(obj, attr, type='raw', suffix='')">\
  % if attr in obj and obj[attr]:
    <div class="name-icon-value col-sm-6">
      <div class="name-icon">
        <span class="glyphicon glyphicon-${'paperclip' if type == 'list' else 'list-alt'}"></span>
        <span class="detail-name">{{mainCtrl.translate('${attr}')}}</span>
      </div>
      % if type == 'i18n':
        <span class="detail-value">{{mainCtrl.translate('${obj[attr]}')}}</span>
      % elif type == 'list':
        <span class="detail-text" ng-repeat="val in ['${"','".join(obj[attr]) |n}']">{{mainCtrl.translate(val)}}</span>
      % elif type =='text':
        <span class="detail-text">${show_attr(obj, attr)}</span>
      % else:
        <span class="detail-text">${obj[attr]}${suffix}</span>
      % endif
    </div>
  % endif
</%def>

<%def name="show_archive_data(module, document, locale, version)">\
  <ul class="archive-data">
    <li translate>You are viewing an archived version of this document.</li>
    <li>{{'${1000 * version['written_at']}' | date:'medium'}} - <a href="#TODO">${version['username']}</a> - ${show_version_comment(version)}</li>
    <li><a href="${request.route_url(module + '_view', id=document['document_id'], lang=locale['lang'])}" translate>See the latest version</a></li>
  </ul>
</%def>

<%def name="show_other_langs_links(module, document, other_langs)">\
  % if other_langs:
    <div class="btn-group view-other-lang">
      <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
        <span translate>View in other lang</span>&nbsp;<span class="caret"></span>
      </button>
      <ul class="dropdown-menu">
      % for l in other_langs:
        <li>
          <a href="${request.route_url(module + '_view', id=document['document_id'], lang=l)}">{{mainCtrl.translate('${l}')}}</a>
          <span class="glyphicon glyphicon-chevron-right"></span>
        </li>
      % endfor
      </ul>
    </div>
  % endif
</%def>

<%def name="show_missing_langs_links(module, document, missing_langs)">\
  % if missing_langs:
    <div class="translate-lang">
      <div class="btn-group">
        <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
          <span translate>Translate into an other lang</span>&nbsp;<span class="caret"></span>
        </button>
        <ul class="dropdown-menu">
        % for lang in missing_langs:
          <li><app-edit-button app-edit-button-url="${request.route_url(module + '_edit', id=document['document_id'], lang=lang)}">{{mainCtrl.translate('${lang}')}}</app-edit-button></li>
        % endfor
        </ul>
      </div>
    </div>
  % endif
</%def>

<%def name="show_route_title(locale, is_tab_title=False)">\
  <%
      title = ''
      if 'title_prefix' in locale and locale['title_prefix']:
          title = locale['title_prefix'] + ' : '
      title += locale['title']
  %>\
${title}${' - Camptocamp.org' if is_tab_title else ''}\
</%def>

<%def name="show_version_comment(version)">\
  ${'{{mainCtrl.translate(\'' + get_attr(version, 'comment', md=False) + '\')}}' if version['comment'] else '' | n}
</%def>

