<%inherit file="../base.html"/>
<%namespace name="helpers" file="../helpers.html" import="add_pagination_links"/>
<%block name="pagetitle">Waypoints</%block>\

<%block name="moduleConstantsValues">
% if len(waypoints):
module.value('mapFeatureCollection', {
  "type": "FeatureCollection",
  "features": [
    <%
    from json import dumps, loads
    features = [];
    for waypoint in waypoints:
        if waypoint['geometry']['geom'] is not None:
            features.append({
                "type": "Feature",
                "geometry": loads(waypoint['geometry']['geom'])
            })
    features = map(lambda f: dumps(f), features)
    %>
    ${', '.join(features) | n}
  ]
});
% endif
</%block>\

<h1>${self.pagetitle()}</h1>
% if len(waypoints):
  <app-map></app-map>
% endif
<p translate ng-init="nbItems = ${total}">{{nbItems}} waypoints</p>
${helpers.add_pagination_links('waypoints', waypoints, total, filter_params)}
<ul>
  <li><a href="${request.route_url('waypoints_add')}" translate>Add a waypoint</a></li>
% for waypoint in waypoints:
  <li>
  % for locale in waypoint['locales']:
    <a href="${request.route_url('waypoints_view', id=waypoint['document_id'], culture=locale['culture'])}">${locale['title']}</a> (${locale['culture']})
  % endfor
  - ${waypoint['elevation']} m</li>
% endfor
</ul>
