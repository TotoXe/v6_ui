<%inherit file="../base.html"/>
<%
updating_doc = waypoint_id and waypoint_culture
%>\

<%block name="pagetitle">
FIXME: Adding/editing page title
</%block>

<h1>${self.pagetitle()}</h1>
<form app-document-editing="waypoints" app-document-editing-model="waypoint"
% if updating_doc:
  app-document-editing-id="${waypoint_id}" app-document-editing-culture="${waypoint_culture}"
% endif
  name="editForm" novalidate ng-submit="editCtrl.submitForm(editForm.$valid)">
  <div id="culture-group" class="form-group" ng-class="{ 'has-error': editForm.culture.$touched && editForm.culture.$invalid }">
    <label>Culture</label>
    % if waypoint_culture:
      ${waypoint_culture}
    % else:
      <select name="culture" ng-options="culture for culture in ['${"','".join(available_cultures) |n}']" 
        ng-model="waypoint.locales[0].culture" class="form-control" required>
      </select>
      <div class="help-block" ng-messages="editForm.culture.$error" ng-if="editForm.culture.$touched">
        <p ng-message="required">Culture is required.</p> 
      </div>
    % endif
  </div>
  <div id="title-group" class="form-group" ng-class="{ 'has-error': editForm.title.$touched && editForm.title.$invalid }">
    <label>Title</label>
    <input type="text" name="title" ng-model="waypoint.locales[0].title" class="form-control" required ng-minlength="3" />
    <div class="help-block" ng-messages="editForm.title.$error" ng-if="editForm.title.$touched">
      <p ng-message="required">Title is required.</p> 
      <p ng-message="minlength">Title is too short.</p>
    </div>
  </div>
  <div id="waypoint_type-group" class="form-group" ng-class="{ 'has-error': editForm.waypoint_type.$touched && editForm.waypoint_type.$invalid }">
    <label>Type</label>
    <select name="waypoint_type" ng-options="type for type in ['${"','".join(waypoint_types) |n}']"
      ng-model="waypoint.waypoint_type" class="form-control" required>
    </select>
    <div class="help-block" ng-messages="editForm.waypoint_type.$error" ng-if="editForm.waypoint_type.$touched">
      <p ng-message="required">Type is required.</p> 
    </div>
  </div>
  <div id="elevation-group" class="form-group" ng-class="{ 'has-error': editForm.elevation.$touched && editForm.elevation.$invalid }">
    <label>Elevation</label>
    <input type="number" name="elevation" ng-model="waypoint.elevation" class="form-control" required max="9999" /> m
    <div class="help-block" ng-messages="editForm.elevation.$error" ng-if="editForm.elevation.$touched">
      <p ng-message="required">Elevation is required.</p> 
      <p ng-message="max">Elevation must be smaller than 9999 m.</p>
    </div>
  </div>
  <div id="longitude-group" class="form-group" ng-class="{ 'has-error': editForm.longitude.$touched && editForm.longitude.$invalid }">
    <label>Longitude</label>
    <input type="number" name="longitude" ng-model="waypoint.geometry.geom.longitude" class="form-control" required min="-180" max="180" /> °E
    <div class="help-block" ng-messages="editForm.longitude.$error" ng-if="editForm.longitude.$touched">
      <p ng-message="required">Longitude is required.</p>
      <p ng-message="min">Longitude must be between -180° and 180°.</p>
      <p ng-message="max">Longitude must be between -180° and 180°.</p>
    </div>
  </div>
  <div id="latitude-group" class="form-group" ng-class="{ 'has-error': editForm.latitude.$touched && editForm.latitude.$invalid }">
    <label>Latitude</label>
    <input type="number" name="latitude" ng-model="waypoint.geometry.geom.latitude" class="form-control" required required min="-90" max="90" /> °N
    <div class="help-block" ng-messages="editForm.latitude.$error" ng-if="editForm.latitude.$touched">
      <p ng-message="required">Latitude is required.</p>
      <p ng-message="min">Latitude must be between -90° and 90°.</p>
      <p ng-message="max">Latitude must be between -90° and 90°.</p>
    </div>
  </div>
  <div id="maps_info-group" class="form-group">
    <label>Maps info</label>
    <input type="text" name="maps_info" ng-model="waypoint.maps_info" class="form-control" />
  </div>
  <div id="description-group" class="form-group">
    <label>Description</label>
    <textarea name="description" ng-model="waypoint.locales[0].description" class="form-control" placeholder="Describe here the WP"></textarea>
  </div>
  % if updating_doc:
  <div id="message-group" class="form-group">
    <label>Comment about the changes</label>
    <input type="text" name="message" ng-model="route.message" class="form-control" placeholder="Short description of the applied changes" />
  </div>
  % endif
  <p>
    <button type="submit" class="btn btn-primary" ng-disabled="editForm.$invalid">Save</button>
    <%
    if updating_doc:
        cancel_url = request.route_url('waypoints_view', id=waypoint_id, culture=waypoint_culture)
    else:
        cancel_url = request.route_url('waypoints_index')
    %>
    <a href="${cancel_url}">Cancel</a>
  </p>
</form>
<h2>Georeferencing the waypoint</h2>
<div id="map" ngeo-map="mainCtrl.map"></div>
