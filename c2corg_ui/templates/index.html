<%!
from c2corg_common.attributes import activities
%>
<%inherit file="base.html"/>

<div class="home-page">
  <section ng-class="{'show': !userCtrl.auth.isAuthenticated()}" class="site-intro not-logged">
    <div class="intro-banner">
      <h1 class="welcome-title text-center" translate>The mountain sports community</h1>

      <div class="route-activities text-center">
        % for activity in activities:
        <a href="${request.route_url('outings_index')}#act=${activity}">
          <span class="activity icon-${activity}" uib-tooltip="{{mainCtrl.translate('${activity}')}}"></span>
        </a>
        % endfor
      </div>

      <p class="text-center" translate>Camptocamp.org aims to facilitate information sharing between mountain addicts and contribute to the safety of mountain activities.</p>

      <div class="intro-shortcuts">
        <a href="${request.route_url('routes_index')}">
          <button class="btn green-btn">
            <span class="glyphicon glyphicon-arrow-right"></span>
            <span translate>Topoguide</span><br>
            <span translate class="small">Conditions, summits, routes</span>...
          </button>
        </a>
        <a href="${discourse_url}">
          <button class="btn blue-btn">
            <span class="glyphicon glyphicon-th-list"></span>
            <span translate>Forum</span><br>
            <span translate class="small">Share with us!</span>
          </button>
        </a>
      </div>

    </div>
  </section>

  <div class="feed">
    <div class="feed-title flex flexend-align" ng-show="!feedCtrl.busy">
      <span class="icon-news"></span>
      <h3 translate>Activity feed</h3>
    </div>

    <div app-feed location="home">
      <h4 class="text-success text-center" translate ng-show="feedCtrl.busy">Loading feed, please wait...</h4>
      <div class="feed-list" ng-show="feedCtrl.documents.length > 0"
           infinite-scroll="feedCtrl.getDocumentsFromFeed()"
           infinite-scroll-immediate-check="false"
           infinite-scroll-disabled="feedCtrl.busy">

        <article class="feed-list-item" protected-url-btn url="${request.route_path('outings_add')}">
          <div class="timeline-bullet icon-outings"></div>
          <div class="list-item vertical-align">
            <button class="orange-btn btn">add an outing</button>
          </div>
        </article>

        <article class="feed-list-item" ng-repeat="doc in feedCtrl.documents"
                 ng-init="type = feedCtrl.documentType(doc.document.type);">

          <div class="timeline-bullet icon-{{type}}s"></div>

          <p class="action-line">
            <span class="action" ng-cloak>
              <b><a ng-href="todo">{{doc['user']['username']}}</a></b>
              <span ng-bind-html="feedCtrl.createActionLine(doc)"></span>
              <b translate>{{type}}</b>
            </span>
            <br>
            <span class="action date">
              <span class=" glyphicon glyphicon-time"></span>
              <span am-time-ago="doc.time"></span>
            </span>
          </p>

          <div class="list-item">
            <app-card app-card-doc="doc['document']" class="{{type}}"></app-card>
          </div>
        </article>
        <h4 class="text-success text-center" translate ng-show="feedCtrl.busy">Loading feed, please wait...</h4>
      </div>

    </div>
  </div>
</div>