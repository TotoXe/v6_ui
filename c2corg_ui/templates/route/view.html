<%!
from c2corg_ui.templates.utils import get_lang_lists
%>\
<%inherit file="../base.html"/>
<%namespace file="../helpers/view.html" import="show_attr, show_short_attr, show_missing_langs_links,
    show_other_langs_links, show_archive_data, show_route_title, show_associated_waypoints,
    show_associated_routes, show_areas, show_maps"/>
<%
route_id = route['document_id']
other_langs, missing_langs = get_lang_lists(route, lang)
%>\
<%block name="pagelang">lang="${lang}"</%block>\
<%block name="pagetitle"><title>${show_route_title(locale, True)}</title></%block>\
<%block name="metarobots">\
  % if version:
<meta name="robots" content="noindex,follow">\
  % else:
<meta name="robots" content="index,follow">\
  %endif
</%block>\


  <header  class="view-details-title">
    <h1>${show_route_title(locale)}<label class="badge" translate>route</label></h1>
  </header>
  <div class="float-buttons" app-view-details>
    <div class="float-button float-edit" tooltip-placement="top" uib-tooltip="{{'Edit' | translate}}">
      <app-edit-button ng-click="ebCtrl.redirect()" app-edit-button-url="${request.route_url('routes_edit', id=route_id, lang=lang)}"></app-edit-button>
      <span class="glyphicon glyphicon-edit"></span>
      <p class="float-button-text" translate>Edit</p>
    </div>
    <div class="float-button float-favorite" tooltip-placement="top" uib-tooltip="{{'Add to favorites' | translate}}">
      <span class="glyphicon glyphicon-heart"></span>
      <p class="float-button-text" translate>Favorites</p>
    </div>
    <div class="float-button float-add" tooltip-placement="top" uib-tooltip="{{'Add' | translate}}">
      <span class="glyphicon glyphicon-plus"></span>
      <p class="float-button-text" translate>Add</p>
    </div>
    <div class="float-button float-comments" tooltip-placement="top" uib-tooltip="{{'Comments' | translate}}">
      <span class="glyphicon glyphicon-comment"></span>
      <p class="float-button-text" translate>Comments</p>
    </div>
    <div class="btn-group float-more float-button " uib-dropdown>
      <span class="glyphicon glyphicon-th-list dropdown-toggle" uib-dropdown-toggle></span>
      <p class="float-button-text" translate>More</p>
      <ul class="dropdown-menu"  role="menu" aria-labelledby="dLabel"> 
        % if version:
        <li>${show_archive_data('routes', route, locale, version)}</li> 
        % endif
        <li><a href="${request.route_url('routes_history', id=route_id, lang=lang)}" translate>History</a></li> 
        % if other_langs:
        <li ng-click="detailsCtrl.openModal('#other-langs')"><a translate>View in other lang</a></li>
        % endif
        % if missing_langs:
        <li ng-click="detailsCtrl.openModal('#missing-langs')"><a translate>Translate into an other lang</a></li>
        % endif
        <li role="separator" class="divider"></li> 
        <li><a href="#">Print</a></li> 
        <li><a href="#">Save</a></li> 
      </ul>
    </div>
  </div>
<app-map class="view-details-map"></app-map>

<section class="view-details-section" app-view-details> 
  <uib-tabset app-view-details>
    <uib-tab heading="Description" ng-click="detailsCtrl.openTab('.view-details-description')"></uib-tab>
    <uib-tab heading="Details" ng-click="detailsCtrl.openTab('.view-details-list')"></uib-tab>
    <uib-tab heading="Associations" ng-click="detailsCtrl.openTab('.view-details-associations')"></uib-tab>
  </uib-tabset>

  <div class="thumbnail view-details-list col-lg-12col-md-12 col-sm-12 tab">
    
    ## LOCATION 
    % if not version:
      <div class="name-icon-value col-sm-6" ng-click="detailsCtrl.openTab($event)">
        <h4><span translate>Location</span><span class="glyphicon glyphicon-menu-right"></span></h4>
        <div class="name-icon">
          <span class="glyphicon glyphicon-map-marker"></span>
          <p translate>Location</p>
        </div>
        <span class="detail-text accordion">
          ${show_areas(route)}
        </span>
      </div>
    % endif

    ## GENERAL 
    <div class="name-icon-value col-sm-6" ng-click="detailsCtrl.openTab($event)">
      <h4><span translate>General</span><span class="glyphicon glyphicon-menu-right"></span></h4>
      <div class="name-icon">
        <span class="glyphicon glyphicon-stats"></span>
        <p translate>General</p>
      </div>
      <span class="detail-text accordion">
         % if route['route_types']:
        <p><span translate>route_types</span>: <b>${route['route_types']}</b></p>
         % endif
        % if route['elevation_max']:
        <p><span translate>elevation_max</span>: <b>${route['elevation_max']} m </b></p>
        % endif
        % if route['elevation_min']:
        <p><span translate>elevation_min</span>: <b>${route['elevation_min']} m </b></p>
        % endif
      </span>
    </div>

    ## SUMMARY
    % if locale['summary']:
    <div class="name-icon-value col-sm-6" ng-click="detailsCtrl.openTab($event)">
      <h4><span translate>summary</span><span class="glyphicon glyphicon-menu-right"></span></h4>
      <div class="name-icon">
        <span class="glyphicon glyphicon-list-alt"></span>
        <p translate>summary</p>
      </div>
      <span class="detail-text accordion">
        ${locale['summary']}
      </span>
    </div>
    % endif

    ##DIFFICULTY
    <div class="name-icon-value col-sm-6" ng-click="detailsCtrl.openTab($event)">
      <h4><span translate>Difficulty</span><span class="glyphicon glyphicon-menu-right"></span></h4>
      <div class="name-icon">
        <span class="glyphicon glyphicon-alert"></span>
        <p translate>Difficulty</p>
      </div>
      <span class="detail-text accordion">
        %if route['height_diff_difficulties']:
        <p><span translate>height_diff_difficulties</span>: <b>${route['height_diff_difficulties']} m</b></p>
        % endif
        % if 'equipment_rating' in route and route['equipment_rating']:
        <p><span translate>equipment_rating</span>: <b>${route['equipment_rating']}</b></p>
        % endif
        % if 'engagement_rating' in route and route['engagement_rating']:
        <p><span translate>engagement_rating</span>: <b>${route['engagement_rating']}</b></p>
        % endif
      </span>
    </div>

    ##ACCESS
    <div class="name-icon-value col-sm-6" ng-click="detailsCtrl.openTab($event)">
      <h4><span translate>Access</span><span class="glyphicon glyphicon-menu-right"></span></h4>
      <div class="name-icon">
        <span class="glyphicon glyphicon-screenshot"></span>
        <p translate>Access</p>
      </div>
      <span class="detail-text accordion" ng-init="lift_access=${route['lift_access']}">
        <span translate>Has lift access</span>:
        <b>{{lift_access == 'None' ? mainCtrl.translate('No'): mainCtrl.translate('Yes')}}</b>
      </span>
    </div>

    ## GEAR
    % if locale['gear']:
    <div class="name-icon-value col-sm-6" ng-click="detailsCtrl.openTab($event)">
      <h4><span translate>gear</span><span class="glyphicon glyphicon-menu-right"></span></h4>
      <div class="name-icon">
        <span class="glyphicon glyphicon-cog"></span>
        <p translate>gear</p>
      </div>
      <span class="detail-text accordion">${locale['gear']}</span>
    </div>
    % endif
  </div>

  ## DESCRIPTION
  <div class="view-details-description col-xs-12 tab">
    <span class="lead">
      <h3 translate class="text-center heading">description</h3>
      ${show_attr(locale, 'description')}
    </span>
  </div>

  ## IMAGES
  % if not version:
    <div class="view-details-photos col-xs-12 tab">
      <span class="lead">
        <h3 translate class="text-center">images</h3>
      </span>
    </div>
  % endif

  ## ASSOCIATIONS
  % if not version:
    <div class="view-details-associations col-xs-12 tab">
      <span class="lead">
        <h3 class="text-center heading" translate>Associations</h3>
        <div ng-show="userCtrl.auth.isAuthenticated()"><span translate>Add association</span>:
          <app-add-association parent-id="${route_id}" added-documents="added"></app-add-association>
        </div>
        <div><span translate>Waypoint associations</span>: ${show_associated_waypoints(route)}
          <ul>
            <li ng-repeat="doc in added | filter:{'documentType': 'waypoints'}">
              <app-association-card></app-association-card>
            </li>
          </ul>
        </div>
        <div><span translate>Route associations</span>: ${show_associated_routes(route)}
          <ul>
            <li ng-repeat="doc in added | filter:{'documentType': 'routes'}">
              <app-association-card></app-association-card>
            </li>
          </ul>
        </div>
        <div><span translate>Maps</span>: ${show_maps(route)}</div>
      </span>
    </div>
  % endif

  ${show_other_langs_links('routes', route, other_langs)}
  ${show_missing_langs_links('routes', route, missing_langs)}
    
  <div class="text-center">
    <button class="btn btn-default scroll-top-btn" onclick="window.scrollTo(0, 0);"translate>To page head <span class="glyphicon glyphicon-menu-up"></span></button>
  </div>
</section>
